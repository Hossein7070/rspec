<p>Applications that execute operating system commands or execute commands that interact with the underlying system should neutralize any externally-provided values used in those commands. Failure to do so could allow an attacker to include input that executes unintended commands or exposes sensitive data.</p>
<p>The problem could be mitigated in any of the following ways:</p>
<ul>
<li>Using <a href="https://docs.python.org/3/library/subprocess.html">subprocess module</a> without the &lt;code&gt;shell=true&lt;/code&gt;. In this case &lt;code&gt;subprocess&lt;/code&gt; expects an array where command and arguments are clearly separated.</li>
<li>Escaping shell argument with <a href="https://docs.python.org/3/library/shlex.html#shlex.quote">shlex.quote</a></li>
</ul>
<h2>Noncompliant Code Example</h2>
<p>&lt;code&gt;os&lt;/code&gt;</p>
<pre>
from flask import request
import os

@app.route('/ping')
def ping():
    address = request.args.get("address")
    cmd = "ping -c 1 %s" % address
    os.popen(cmd) # Noncompliant
</pre>
<p>&lt;code&gt;subprocess&lt;/code&gt;</p>
<pre>
from flask import request
import subprocess

@app.route('/ping')
def ping():
    address = request.args.get("address")
    cmd = "ping -c 1 %s" % address
    subprocess.Popen(cmd, shell=True) # Noncompliant; using shell=true is unsafe
</pre>
<h2>Compliant Solution</h2>
<p>&lt;code&gt;os&lt;/code&gt;</p>
<pre>
from flask import request
import os

@app.route('/ping')
def ping():
    address = shlex.quote(request.args.get("address")) # address argument is shell-escaped
    cmd = "ping -c 1 %s" % address
    os.popen(cmd ) # Compliant
</pre>
<p>&lt;code&gt;subprocess&lt;/code&gt;</p>
<pre>
from flask import request
import subprocess

@app.route('/ping')
def ping():
    address = request.args.get("address")
    args = ["ping", "-c1", address]
    subprocess.Popen(args) # Compliant
</pre>
<h2>See</h2>
<ul>
<li>OWASP OS Command Injection Defense <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">Cheat Sheet</a></li>
<li><a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection">OWASP Top 10 2017 Category A1</a> - Injection</li>
<li><a href="http://cwe.mitre.org/data/definitions/77">MITRE, CWE-77</a> - Improper Neutralization of Special Elements used in a Command ('Command Injection')</li>
<li><a href="http://cwe.mitre.org/data/definitions/78">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command</li>
<li><a href="http://cwe.mitre.org/data/definitions/88">MITRE, CWE-88</a> - Argument Injection or Modification</li>
<li><a href="https://www.sans.org/top25-software-errors/#cat1">SANS Top 25</a> - Insecure Interaction Between Components</li>
</ul>
