<p>Executing code dynamically is security sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
<li><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9807">CVE-2017-9807</a></li>
<li><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9802">CVE-2017-9802</a></li>
</ul>
<p>Any code which is dynamically evaluated in your process will have the same permissions as the rest of your code. Thus it is very dangerous to do so with code coming from an untrusted source. <a href="https://www.owasp.org/index.php/Code_Injection">Injected Code</a> can either run on the server or in the client (exemple: XSS attack).</p>
<p>&lt;code&gt;EXECUTE IMMEDIATE&lt;/code&gt; executes as a dynamic SQL statement or anonymous PL/SQL block the string passed as an argument. It’s safe only if the argument is composed of constant character string expressions. But if the command string is dynamically built using external parameters, then it is considered very dangerous because executing a random string allows the execution of arbitrary code.</p>
<p>This rule marks for review each occurence of dynamic code execution.</p>
<h2>Ask Yourself Whether</h2>
<ul>
<li>the executed code may come from an untrusted source and hasn’t been sanitized.</li>
<li>you really need to run code dynamically.</li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The best solution is to not run code provided by an untrusted source. If you really need to build a command string using external parameters, you should use &lt;code&gt;EXECUTE IMMEDIATE&lt;/code&gt; with bind variables instead.</p>
<p>Do not try to create a blacklist of dangerous code. It is impossible to cover all attacks that way.</p>
<h2>Sensitive Code Example</h2>
<pre>
CREATE OR REPLACE PROCEDURE ckpwd (p_user IN VARCHAR2, p_pass IN VARCHAR2)
IS
 v_query  VARCHAR2(100);
 v_output NUMBER;
BEGIN
 v_query :=    q'{SELECT COUNT(*) FROM user_pwd }'
         ||    q'{WHERE username = '}'
         ||    p_user
         ||    q'{' AND password = '}'
         ||    p_pass
         ||    q'{'}';
 EXECUTE IMMEDIATE v_query
  INTO v_output;
END;
</pre>
<h2>Compliant Solution</h2>
<pre>
CREATE OR REPLACE PROCEDURE ckpwd_bind (p_user IN VARCHAR2, p_pass IN VARCHAR2)
IS
 v_query  VARCHAR2(100);
 v_output NUMBER;
BEGIN
 v_query :=
   q'{SELECT COUNT(*) FROM user_pwd WHERE username = :1 AND password = :2}';
 EXECUTE IMMEDIATE v_query
  INTO v_output
  USING p_user, p_pass;
END;
</pre>
<h2>See</h2>
<ul>
<li><a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection">OWASP Top 10 2017 Category A1</a> - Injection</li>
<li><a href="http://cwe.mitre.org/data/definitions/95.html">MITRE CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')</li>
</ul>
