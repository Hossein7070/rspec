<p><a href="https://en.wikipedia.org/wiki/HTTP_referer">HTTP header referer</a> contains a URL set by web browsers and used by applications to track from where the user came from, it’s for instance a relevant value for web analytic services, but it can cause <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Referer_header:_privacy_and_security_concerns">serious privacy and security problems</a> if the URL contains confidential information. Note that Firefox for instance to prevent data leaks <a href="https://blog.mozilla.org/security/2018/01/31/preventing-data-leaks-by-stripping-path-information-in-http-referrers/">removes path information</a> in the Referer header while browsing privately.</p>
<p>Suppose an e-commerce website asks the user his credit card number to purchase a product:</p>
<pre>
&lt;html&gt;
&lt;body&gt;
&lt;form action="/valid_order" method="GET"&gt;
Type your credit card number to purchase products:
&lt;input type=text id="cc" value="1111-2222-3333-4444"&gt;
&lt;input type=submit&gt;
&lt;/form&gt;
&lt;/body&gt;
</pre>
<p>When submitting the above HTML form a HTTP GET request will be performed, the URL requested will be <a href="https://example.com/valid_order?cc=1111-2222-3333-4444">https://example.com/valid_order?cc=1111-2222-3333-4444</a> with credit card number inside and it’s obviously not secure for these reasons:</p>
<ul>
<li>URLs are stored in the history of browsers.</li>
<li>URLs could be accidentally shared when doing copy/paste actions.</li>
<li>URLs can be stolen if a malicious person looks at the computer screen of an user.</li>
</ul>
<p>In addition to these threats, when further requests will be performed from the  <em>valid_order</em> page with a simple legitimate embedded script like that:</p>
<pre>
&lt;script src="https://webanalyticservices_example.com/track"&gt;
</pre>
<p>The referer header which contains confidential information will be send to a third party web analytic service and cause privacy issue:</p>
<pre>
GET /track HTTP/2.0
Host: webanalyticservices_example.com
Referer: https://example.com/valid_order?cc=1111-2222-3333-4444
</pre>
<h2>Ask Yourself Whether</h2>
<ul>
<li>Confidential information exists in URLs.</li>
<li>Semantic of HTTP methods is not respected (eg: use of a GET method instead of POST when the state of the application is changed).</li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
<li>Confidential information should not be set inside URLs (GET requests) of the application and implementation of <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy">Referrer-Policy</a> header with a safe policy, different from &lt;code&gt;unsafe-url&lt;/code&gt; or &lt;code&gt;no-referrer-when-downgrade&lt;/code&gt;, allows to control how much information is included in the referer header.</li>
</ul>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet">helmet</a> &lt;code&gt;referrerPolicy&lt;/code&gt; middleware is not used or used with unsafe values:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express(); // Sensitive helmet.referrerPolicy not used

app.get('/', function (req, res) {
  res.send('Hello World!&lt;script src="https://example.com/test"&gt;&lt;/script&gt;&lt;script src="http://example.com/test"&gt;&lt;/script&gt;')
});
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to implement referrer-policy is with the <a href="https://www.npmjs.com/package/helmet">helmet</a> middleware:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(helmet.referrerPolicy({policy: 'no-referrer'})); // Compliant

app.get('/', function (req, res) {
  res.send('Hello World!&lt;script src="https://example.com/test"&gt;&lt;/script&gt;&lt;script src="http://example.com/test"&gt;&lt;/script&gt;')
});
</pre>
<h2>See</h2>
<ul>
<li><a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy">developer.mozilla.org</a> - Referrer-Policy</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Referer_header:_privacy_and_security_concerns">developer.mozilla.org</a> - Referer header: privacy and security concerns</li>
<li><a href="https://cwe.mitre.org/data/definitions/200.html">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor</li>
</ul>
