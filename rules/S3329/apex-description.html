<p>In encryption, when Cipher Block Chaining (CBC) is used, the Initialization Vector (IV) must be random and unpredictable. Otherwise, the encrypted value is vulnerable to crypto-analysis attacks such as the "Chosen-Plaintext Attack".</p>
<p>An IV value should be associated to one, and only one encryption cycle, because the IV’s purpose is to ensure that the same plaintext encrypted twice will yield two different ciphertexts.</p>
<p>To that end, IV’s should be:</p>
<ul>
<li>random</li>
<li>unpredictable</li>
<li>publishable (IVs are frequently published)</li>
<li>authenticated, along with the ciphertext, with a Message Authentication Code (MAC)</li>
</ul>
<p>This rule raises an issue when the IV is hard-coded.</p>
<h2>Noncompliant Code Example</h2>
<pre>
Blob cryptoKey = Crypto.generateAesKey(256);
Blob hardcoded_iv = Blob.valueOf('hardcoded IV');
Blob data = Blob.valueOf('some secret data');
Blob encryptedData = Crypto.encrypt('AES256', hardcoded_iv, key, data);  // Noncompliant, the IV is hardcoded
</pre>
<h2>Compliant Solution</h2>
<pre>
Blob cryptoKey = Crypto.generateAesKey(256);
Blob data = Blob.valueOf('some secret data');
Blob encryptedData = Crypto.encryptWithManagedIV('AES256', key, data);
</pre>
<h2>See</h2>
<ul>
<li><a href="http://cwe.mitre.org/data/definitions/330">MITRE, CWE-330</a> - Use of Insufficiently Random Values</li>
<li>OWASP Top 10 2017 Category A6 - Security Misconfiguration</li>
<li><a href="https://developer.salesforce.com/page/Apex_Crypto_Class">Using the Apex Crypto Class</a></li>
</ul>
