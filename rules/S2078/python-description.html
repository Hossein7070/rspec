<p>User provided data such as URL parameters should always be considered as untrusted and tainted. Constructing LDAP names or search filters directly from tainted data enables attackers to inject specially crafted values that changes the initial meaning of the name or filter itself. Successful LDAP injections attacks can read, modify or delete sensitive information from the directory service.</p>
<p>Within LDAP names, the special characters &lt;code&gt;' '&lt;/code&gt;, &lt;code&gt;'#'&lt;/code&gt;, &lt;code&gt;'"'&lt;/code&gt;, &lt;code&gt;'+'&lt;/code&gt;, &lt;code&gt;','&lt;/code&gt;, &lt;code&gt;';'&lt;/code&gt;, &lt;code&gt;'&lt;'&lt;/code&gt;, &lt;code&gt;'&gt;'&lt;/code&gt;, &lt;code&gt;'\'&lt;/code&gt; and &lt;code&gt;null&lt;/code&gt; must be escaped according to RFC 4514, for example by replacing them with the backslash character &lt;code&gt;'\'&lt;/code&gt; followed by the two hex digits corresponding to the ASCII code of the character to be escaped. Similarly, LDAP search filters must escape a different set of special characters (including but not limited to &lt;code&gt;'*'&lt;/code&gt;, &lt;code&gt;'('&lt;/code&gt;, &lt;code&gt;')'&lt;/code&gt;, &lt;code&gt;'\'&lt;/code&gt; and &lt;code&gt;null&lt;/code&gt;) according to RFC 4515.</p>
<h2>Noncompliant Code Example</h2>
<pre>
from flask import request
import ldap

@app.route("/user")
def user():
    dn =  request.args['dn']
    username =  request.args['username']

    search_filter = "(&amp;(objectClass=*)(uid="+username+"))"
    ldap_connection = ldap.initialize("ldap://127.0.0.1:389")
    user = ldap_connection.search_s(dn, ldap.SCOPE_SUBTREE, search_filter) # Noncompliant
    return user[0]
</pre>
<h2>Compliant Solution</h2>
<pre>
from flask import request
import ldap
import ldap.filter
import ldap.dn

@app.route("/user")
def user():
    dn = "dc=%s" % ldap.dn.escape_dn_chars(request.args['dc']) # Escape distinguished names special characters
    username = ldap.filter.escape_filter_chars(request.args['username']) # Escape search filters special characters

    search_filter = "(&amp;(objectClass=*)(uid="+username+"))"
    ldap_connection = ldap.initialize("ldap://127.0.0.1:389")
    user = ldap_connection.search_s(dn, ldap.SCOPE_SUBTREE, search_filter) # Compliant
    return user[0]
</pre>
<h2>See</h2>
<ul>
<li><a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection">OWASP Top 10 2017 Category A1</a> - Injection</li>
<li><a href="https://www.ietf.org/rfc/rfc4514.txt">RFC 4514</a> - LDAP: String Representation of Distinguished Names</li>
<li><a href="https://www.ietf.org/rfc/rfc4515.txt">RFC 4515</a> - LDAP: String Representation of Search Filters</li>
<li><a href="http://cwe.mitre.org/data/definitions/90">MITRE CWE-90</a> - Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection')</li>
<li><a href="https://www.securecoding.cert.org/confluence/x/CgLEAw">CERT, IDS54-J.</a> - Prevent LDAP injection</li>
</ul>
