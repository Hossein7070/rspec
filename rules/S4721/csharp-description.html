<p>Arbitrary OS commands can be executed by an attacker when:</p>
<ul>
<li>The OS command name to execute is user-controlled.</li>
<li>A shell is spawn rather than a new process, in this case shell meta-chars can be used (when parameters are user-controlled for instance) to inject OS commands.</li>
<li>The executable is searched in the directories specified by the PATH variable (which can contain user-controlled or malicious directories).</li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
<li>OS command name or parameters are user-controlled.</li>
<li>The relative path of the OS command is specified.</li>
<li>OS commands are not executed in an isolated/sandboxed environment.</li>
<li>OS command are executed with high privileges.</li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
<li>User-controlled inputs should not be used, for any reasons, to build a dynamically OS command (command name or even parameters when shell is used).</li>
<li>Fully qualified/absolute path should be used to specify the OS command to execute.</li>
<li>If possible, set the lowest privileges to the new process/shell in which commands are executed.</li>
<li>If possible, execute the OS commands in an isolated environment.</li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
public void SensitiveExample() {
   String cmd="file.exe";
   var startInfo = new ProcessStartInfo();
   startInfo.FileName = cmd; // Sensitive: file.exe will be search in PATH directories
}
</pre>
<h2>Compliant Solution</h2>
<pre>
public void CompliantExample() {
   String cmd="/usr/bin/file.exe";
   var startInfo = new ProcessStartInfo();
   startInfo.FileName = cmd; // Compliant
}
</pre>
<h2>See</h2>
<ul>
<li><a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection">OWASP Top 10 2017 Category A1</a> - Injection</li>
<li><a href="http://cwe.mitre.org/data/definitions/78">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command</li>
<li><a href="https://www.sans.org/top25-software-errors/#cat1">SANS Top 25</a> - Insecure Interaction Between Components</li>
</ul>
