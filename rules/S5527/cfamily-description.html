<p>To establish a SSL/TLS connection not vulnerable to man-in-the-middle attacks, it’s essential to make sure the server presents the right certificate.
The certificate’s hostname-specific data should match the server hostname.</p>
<p>It’s not recommended to re-invent the wheel by implementing custom hostname verification.
TLS/SSL libraries provide built-in hostname verification functions that should be used.</p>
<h2>Noncompliant Code Examples</h2>
<p><a href="https://github.com/curl/curl">libcurl</a></p>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl;
curl_global_init(CURL_GLOBAL_DEFAULT);

curl = curl_easy_init();
curl_easy_setopt(curl, CURLOPT_URL, "https://example.com/");
curl_easy_setopt(curl, CURLOPT_SSL_VERIFYPEER, 1L);

curl_easy_setopt(curl, CURLOPT_SSL_VERIFYHOST, 0L); // Noncompliant
</pre>
<p><a href="https://github.com/openssl/openssl">OpenSSL</a></p>
<pre>
#include &lt;openssl/ssl.h&gt;

SSL_CTX *ctx = get_ctx();
SSL *ssl = SSL_new(ctx);

// ...

// By default hostname validation is disabled
// `SSL_set1_host` is not called
SSL_set_verify(ssl, SSL_VERIFY_PEER, NULL);

// ...

SSL_connect(ssl); // Noncompliant
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://github.com/curl/curl">libcurl</a></p>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl;
curl_global_init(CURL_GLOBAL_DEFAULT);

curl = curl_easy_init();
curl_easy_setopt(curl, CURLOPT_URL, "https://example.com/");
curl_easy_setopt(curl, CURLOPT_SSL_VERIFYPEER, 1L);

curl_easy_setopt(curl, CURLOPT_SSL_VERIFYHOST, 2L); // Compliant
</pre>
<p><a href="https://github.com/openssl/openssl">OpenSSL</a></p>
<pre>
#include &lt;openssl/ssl.h&gt;

SSL_CTX *ctx = get_ctx();
SSL *ssl = SSL_new(ctx);

// ...

SSL_set1_host(ssl, HOST_NAME); // Compliant
SSL_set_verify(ssl, SSL_VERIFY_PEER, NULL);

// ...

SSL_connect(ssl); // Noncompliant
</pre>
<h2>See</h2>
<ul>
<li><a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure</li>
<li><a href="https://www.owasp.org/index.php/Top_10-2017_A6-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security Misconfiguration</li>
<li><a href="https://cwe.mitre.org/data/definitions/297.html">MITRE, CWE-297</a> - Improper Validation of Certificate with Host Mismatch</li>
</ul>
