<p><a href="https://en.wikipedia.org/wiki/Clickjacking">Clickjacking</a> attacks occur when an attacker try to trick an user to click on certain buttons/links of a legit website. This attack can take place with malicious HTML frames well hidden in an attacker website.</p>
<p>For instance, suppose a safe and authentic page of a social network (<a href="https://socialnetworkexample.com/make_myprofil_public">https://socialnetworkexample.com/make_myprofil_public</a>) which allows an user to change the visibility of his profile by clicking on a button. This is a critical feature with high privacy concerns. Users are generally well informed on the social network of the consequences of this action. An attacker can trick users, without their consent, to do this action with the below embedded code added on a malicious website:</p>
<pre>
&lt;html&gt;
&lt;b&gt;Click on the button below to win 5000$&lt;/b&gt;
&lt;br&gt;
&lt;iframe src="https://socialnetworkexample.com/makemyprofilpublic" width="200" height="200"&gt;&lt;/iframe&gt;
&lt;/html&gt;
</pre>
<p>Playing with the size of the iframe itâ€™s sometimes possible to display only the critical parts of a page, in this case the button of the <em>make_myprofil_public</em> page.</p>
<h2>Ask Yourself Whether</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Clickjacking#Clickjacking_categories">Critical actions</a> of the application are prone to clickjacking attacks because a simple click on a link or a button can trigger them.</li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
<li>Implement content security policy <em>frame-ancestors</em> directive which is supported by all modern browsers and will specify the origins of frame allowed to be loaded by the browser (this directive deprecates <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options">X-Frame-Options</a>).</li>
</ul>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet-csp">helmet-csp middleware</a> is not used or used without the &lt;code&gt;frame-ancestors&lt;/code&gt; directive (or if &lt;code&gt;frame-ancestors&lt;/code&gt; is set to &lt;code&gt;'none'&lt;/code&gt;):</p>
<pre>
const express = require('express');
const helmetCsp = require('helmet-csp');

let app = express();
let csp = helmetCsp({ // Sensitive: frame-ancestors directive doesn't specify which origins are allowed to load the page as a frame
  directives: {
    frame-ancestors: ["'none'"]
  }
});
app.use(csp);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to implement CSP frame-ancestors directive is the <a href="https://www.npmjs.com/package/helmet-csp">helmet-csp middleware</a>:</p>
<pre>
const express = require('express');
const helmetCsp = require('helmet-csp');

let app = express();
let csp = helmetCsp({ // Compliant
  directives: {
    frame-ancestors: ["'self'", 'example.com']
  }
});
app.use(csp);
</pre>
<h2>See</h2>
<ul>
<li><a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security Misconfiguration</li>
<li><a href="https://owasp.org/www-project-cheat-sheets/cheatsheets/Clickjacking_Defense_Cheat_Sheet">OWASP Cheat Sheets</a> - Clickjacking Defense Cheat Sheet</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors">developer.mozilla.org</a> - Frame-ancestors</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">developer.mozilla.org</a> - Content Security Policy (CSP)</li>
<li><a href="https://www.w3.org/TR/CSP3/">w3.org</a> - Content Security Policy Level 3</li>
</ul>
