<p>Web browsers, CDNs or similar proxy-servers can cache HTTP responses (especially large content such as images, scripts etc) to improve web browsing performance and to not overload the application serving the resources. However this may lead to privacy issues if a private web page containing personal user information is cached and served to another user. A different type of attacks allowed when caching resources at the web-browser level is cross-site leak attacks/side-channel attacks, here the attacker infers information about an user (for instance,  web page he is visiting) by observing timing responses or other relevant data when requesting private resources that may be cached.</p>
<p>Example of a side channel attack:</p>
<ul>
<li>The attacker wants to known if a user is involved in a confidential agreement between two companies A and B.</li>
<li>If it is the case, the user can access to the resource <em>contract-between-A-and-B.png</em> after being authenticated on a website.</li>
<li>The attacker tricks the user to visit a malicious website containing the below code in order to determine the desired information:</li>
</ul>
<pre>
&lt;img id="leakyimage" src=""&gt;
&lt;script language="javascript"&gt;
  leakyimage.src = "https://targetexample.com/private/contract-between-A-and-B.png";

  leakyimage.onload = function SideChannelObservations() {
    // compare timing between a cached image and not cached image
    // or success of load
    // in order to determine if the image is cached and so if the user has right to access to this image
  }
&lt;/script&gt;
</pre>
<h2>Ask Yourself Whether</h2>
<ul>
<li>The web application serves HTTP responses which contain confidential information belonging to an authenticated user for instance.</li>
<li>Resources like images or documents (contract.png, attachment.png etc…​) are only accessible to private groups (authenticated, administrators …​) of users.</li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
<li>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control">Cache-Control</a> HTTP header with a cacheability directive set to &lt;code&gt;private&lt;/code&gt; in order to instruct shared caches (CDNs, proxies) to avoid caching. If the risk is too important, it is recommended to not cache anything at the web browser level too, with a cacheability directive set to &lt;code&gt;no-store&lt;/code&gt;.</li>
</ul>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/nocache">helmet nocache</a> middleware is not used:</p>
<pre>
const express = require('express');
let app = express(); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to implement cache-control HTTP header with no-store directive is with the <a href="https://www.npmjs.com/package/nocache">helmet nocache</a> middleware:</p>
<pre>
const express = require('express');
const nocache = require('nocache');
const helmet = require('helmet');

let app = express();
app.use(nocache()); // Compliant
// or
app.use(helmet.nocache()); // Compliant
</pre>
<h2>See</h2>
<ul>
<li><a href="https://cwe.mitre.org/data/definitions/525.html">CWE-525</a> - Use of Web Browser Cache Containing Sensitive Information</li>
<li><a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure.html">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control">developer.mozilla.org</a> - Cache-Control</li>
</ul>
